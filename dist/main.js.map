{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./local_modules/fd/index.ts","webpack:///./local_modules/streamsearch/index.ts","webpack:///./node_modules/baseconv/index.js","webpack:///./node_modules/http-hash/index.js","webpack:///./src/lib/b2/index.ts","webpack:///./src/lib/imgstor.ts","webpack:///./src/lib/sha1.ts","webpack:///./src/lib/util.ts","webpack:///./src/main.ts","webpack:///./src/routers/i.muki.pw/api/auth.ts","webpack:///./src/routers/i.muki.pw/api/hist.ts","webpack:///./src/routers/i.muki.pw/api/new.ts","webpack:///./src/routers/i.muki.pw/api/up.ts","webpack:///./src/routers/i.muki.pw/index.ts","webpack:///./src/routers/i.muki.pw/test.ts","webpack:///./src/routers/index.ts"],"names":[],"mappings":"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CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzDa;;AAEb;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,mBAAmB,yBAAyB;AAC5C;;AAEA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,mBAAmB,yBAAyB;AAC5C;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;;;AC9KA,8EAAgF;AA0ChF,MAAM,OAAO,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC;AAElC,MAAa,UAAW,SAAQ,KAAK;IACjC,YAAY,IAAS,EAAE,GAAG,KAAY;QAClC,KAAK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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import { StreamSearch, MATCH } from '../streamsearch';\r\n\r\nvar RE_BOUNDARY = /^multipart\\/form-data(?:; boundary=(?:\"(.+)\"|([^\\s]+)))$/i;\r\nfunction parseContentDispositionFields(line: string): { [key: string]: string } {\r\n    const fields = {};\r\n    while (true) {\r\n        const eq = line.indexOf('=');\r\n        if (eq === -1) {\r\n            throw new Error('malformed content-disposition field');\r\n        }\r\n\r\n        const key = line.slice(0, eq).trim();\r\n        line = line.slice(eq + 1);\r\n\r\n        let value = '';\r\n        if (line[0] === '\"') {\r\n            line = line.slice(1);\r\n\r\n            while (true) {\r\n                const quote = line.indexOf('\"');\r\n                if (quote === -1) {\r\n                    throw new Error('malformed content-disposition field');\r\n                }\r\n                try {\r\n                    if (value[quote - 1] === '\\\\') {\r\n                        value += line.slice(0, quote + 1);\r\n                    } else {\r\n                        value += line.slice(0, quote);\r\n                        break;\r\n                    }\r\n                } finally {\r\n                    line = line.slice(quote + 1);\r\n                }\r\n            }\r\n        } else {\r\n            const sp = line.indexOf(' ');\r\n            value = line.slice(0, sp);\r\n            line = line.slice(0, sp + 1);\r\n        }\r\n\r\n        fields[key] = value;\r\n\r\n        const semi = line.indexOf(';');\r\n        if (semi === -1) {\r\n            break;\r\n        } else {\r\n            line = line.slice(semi + 1);\r\n        }\r\n    }\r\n\r\n    return fields;\r\n}\r\n\r\nasync function parseUrlEncodedForm(this: TextDecoder, body: ReadableStream<Uint8Array>): Promise<Map<string, string>> {\r\n    let text = '';\r\n\r\n    const reader = body.getReader();\r\n    while (true) {\r\n        const { done, value } = await reader.read();\r\n        if (done) {\r\n            break;\r\n        }\r\n\r\n        text += this.decode(value);\r\n    }\r\n\r\n    return text.split('&')\r\n        .map((kv) => kv.split('='))\r\n        .reduce((map, [k, v]): Map<string, string> => (map.set(k, decodeURIComponent(v)), map), new Map);\r\n}\r\n\r\nfunction createReadableStream(buffers: Uint8Array[]): ReadableStream<Uint8Array> {\r\n    // return new ReadableStream<Uint8Array>({\r\n    //     pull(controller: ReadableStreamDefaultController) {\r\n    //         for (const buf of buffers) {\r\n    //             controller.enqueue(buf);\r\n    //         }\r\n    //         controller.close();\r\n    //     }\r\n    // });\r\n\r\n    const ts = new TransformStream<Uint8Array, Uint8Array>();\r\n    (async function() {\r\n        const w = ts.writable.getWriter();\r\n        for (const buf of buffers) {\r\n            await w.write(buf);\r\n        }\r\n        await w.close();\r\n    })();\r\n    return ts.readable;\r\n    \r\n    // let locked = false;\r\n    // return {\r\n    //     getReader(): ReadableStreamReader<Uint8Array> {\r\n    //         if (locked) {\r\n    //             throw new TypeError('ReadableStreamReader constructor can only accept readable streams that are not yet locked to a reader');\r\n    //         }\r\n\r\n    //         locked = true;\r\n\r\n    //         let i = 0;\r\n    //         return {\r\n    //             cancel: () => Promise.resolve(),\r\n    //             read: (): Promise<ReadableStreamReadResult<Uint8Array>> => {\r\n    //                 if (i < buffers.length) {\r\n    //                     try {\r\n    //                         return Promise.resolve({ done: false, value: buffers[i] });\r\n    //                     } finally {\r\n    //                         i += 1;\r\n    //                     }\r\n    //                 }\r\n                    \r\n    //                 return Promise.resolve({ done: true, value: null });\r\n    //             },\r\n    //             releaseLock: (): void => {\r\n    //                 locked = false;\r\n    //             }\r\n    //         } as ReadableStreamReader<Uint8Array>;\r\n    //     },\r\n    // } as ReadableStream<Uint8Array>;\r\n}\r\n\r\ninterface File extends ReadableStream<Uint8Array> {\r\n    name: string;\r\n    type: string;\r\n    size: number;\r\n}\r\n\r\nconst CRLF = new Uint8Array('\\r\\n'.split('').map((c) => c.charCodeAt(0)))\r\n\r\nasync function parseFormPart(this: TextDecoder, buffers: Uint8Array[]): Promise<[string, string | File]> {\r\n    const parts: Uint8Array[][] = [];\r\n    for await (const token of new StreamSearch(CRLF, createReadableStream(buffers))) {\r\n        if (token === MATCH) {\r\n            parts.push([]);\r\n        } else if (!parts.length) {\r\n            throw new Error('malformed multipart/form-data');\r\n        } else {\r\n            parts[parts.length - 1].push(token);\r\n        }\r\n    }\r\n\r\n    let headers = new Headers();\r\n    let body: Uint8Array[];\r\n    for (const line of parts.slice(0, -1)) {\r\n        if (body) {\r\n            body.push(...line, CRLF);\r\n            continue;\r\n        }\r\n\r\n        if (line.reduce((n, b) => n + b.length, 0) == 0) {\r\n            body = [];\r\n            continue;\r\n        }\r\n\r\n        const header = line.reduce((s, b) => s + this.decode(b), new String);\r\n        const sep = header.indexOf(':');\r\n        headers.append(header.slice(0, sep), header.slice(sep + 1).trim());\r\n    }\r\n\r\n    body = body.slice(0, body.length - 1);\r\n\r\n    const contentDisposition = headers.get('content-disposition');\r\n    if (!contentDisposition.startsWith('form-data;')) {\r\n        // https://tools.ietf.org/html/rfc7578#section-4.2\r\n        throw new Error('malformed multipart/form-data');\r\n    }\r\n\r\n    const cdFields = parseContentDispositionFields(contentDisposition.slice(10));\r\n\r\n    const name = cdFields['name'];\r\n    if (!name) {\r\n        throw new Error('malformed multipart/form-data');\r\n    }\r\n\r\n    const properties = {};\r\n    const filename = cdFields['filename'];\r\n    if (filename) {\r\n        properties['name'] = { writable: false, value: filename }\r\n    }\r\n\r\n    const contentType = headers.get('content-type');\r\n    if (contentType) {\r\n        properties['type'] = { writable: false, value: contentType };\r\n    }\r\n\r\n    if (!Object.keys(properties).length) {\r\n        return [name, body.reduce((text, buf) => text + this.decode(buf), '')];\r\n    }\r\n\r\n    properties['size'] = { writable: false, value: body.reduce((len, buf) => len + buf.length, 0) };\r\n\r\n    return [name, Object.defineProperties(createReadableStream(body), properties)];\r\n}\r\n\r\nasync function parseMultipartForm(this: TextDecoder, boundary: string, body: ReadableStream<Uint8Array>): Promise<Map<string, string | File>> {\r\n    const parts = [];\r\n    for await (const token of new StreamSearch('--' + boundary, body)) {\r\n        if (token === MATCH) {\r\n            parts.push([]);\r\n        } else {\r\n            parts[parts.length - 1].push(token);\r\n        }\r\n    }\r\n\r\n    const map = new Map();\r\n    for (const bufs of parts) {\r\n        if (!bufs.length || this.decode(bufs[0]).startsWith('--')) {\r\n            break;\r\n        }\r\n\r\n        const [key, value] = await parseFormPart.call(this, bufs);\r\n        map.set(key, value);\r\n    }\r\n\r\n    return map;\r\n}\r\n\r\nexport default async function parseFormData(req: Request): Promise<Map<string, string | File>> {\r\n    const decoder = new TextDecoder();\r\n\r\n    const type = req.headers.get('Content-Type');\r\n    if (type.startsWith('application/x-www-form-urlencoded')) {\r\n        return parseUrlEncodedForm.call(decoder, req.body);\r\n    }\r\n\r\n    const matches = RE_BOUNDARY.exec(type);\r\n    if (matches && (matches[1] || matches[2])) {\r\n        return parseMultipartForm.call(decoder, matches[1] || matches[2], req.body);\r\n    }\r\n\r\n    throw new Error('Unexpected Content-Type header');\r\n}\r\n","/*\r\n  Based heavily on the Streaming Boyer-Moore-Horspool C++ implementation\r\n  by Hongli Lai at: https://github.com/FooBarWidget/boyer-moore-horspool\r\n*/\r\nfunction jsmemcmp(buf1, pos1, buf2, pos2, num) {\r\n    for (var i = 0; i < num; ++i) {\r\n        if (buf1[pos1 + i] !== buf2[pos2 + i]) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nexport const MATCH = Symbol('Match');\r\n\r\ntype Token = Uint8Array | typeof MATCH;\r\n\r\nexport class StreamSearch {\r\n    private _needle: Uint8Array;\r\n    private _lastChar: number;\r\n    private _occ: Array<number>;\r\n\r\n    private _lookbehind = new Uint8Array();\r\n\r\n    constructor(needle: Uint8Array | string, private _readableStream: ReadableStream<Uint8Array>) {\r\n        if (typeof needle === 'string') {\r\n            this._needle = needle = new Uint8Array(needle.split('').map((c) => c.charCodeAt(0)));\r\n        } else {\r\n            this._needle = needle;\r\n        }\r\n\r\n        this._lastChar = needle[needle.length - 1];\r\n\r\n        // Populate occurrence table with analysis of the needle,\r\n        // ignoring last letter.\r\n        this._occ = Array.from(new Array(256), () => needle.length);\r\n        if (needle.length > 0) {\r\n            for (let i = 0; i < needle.length - 1; i++) {\r\n                this._occ[needle[i]] = needle.length - 1 - i;\r\n            }\r\n        }\r\n    }\r\n\r\n    async *[Symbol.asyncIterator](): AsyncIterableIterator<Token> {\r\n        const reader = this._readableStream.getReader();\r\n        try {\r\n            while (true) {\r\n                const { done, value: chunk } = await reader.read();\r\n                if (done) {\r\n                    return;\r\n                }\r\n\r\n                let pos = 0;\r\n                let tokens: Token[];\r\n                while (pos !== chunk.length) {\r\n                    [pos, ...tokens] = this._feed(chunk, pos);\r\n\r\n                    yield* tokens;\r\n                }\r\n            }\r\n        } finally {\r\n            reader.releaseLock();\r\n        }\r\n    }\r\n\r\n    private _feed(data: Uint8Array, buf_pos: number): [number, ...Token[]] {\r\n        const tokens: Token[] = [];\r\n\r\n        // Positive: points to a position in `data`\r\n        //           pos == 3 points to data[3]\r\n        // Negative: points to a position in the lookbehind buffer\r\n        //           pos == -2 points to lookbehind[lookbehind_size - 2]\r\n        let pos = -this._lookbehind.length;\r\n\r\n        if (pos < 0) {\r\n            // Lookbehind buffer is not empty. Perform Boyer-Moore-Horspool\r\n            // search with character lookup code that considers both the\r\n            // lookbehind buffer and the current round's haystack data.\r\n            //\r\n            // Loop until (condition 1)\r\n            //   there is a match.\r\n            // or until\r\n            //   we've moved past the position that requires the\r\n            //   lookbehind buffer. In this case we switch to the\r\n            //   optimized loop.\r\n            // or until (condition 3)\r\n            //   the character to look at lies outside the haystack.\r\n            while (pos < 0 && pos <= data.length - this._needle.length) {\r\n                const ch = this._charAt(data, pos + this._needle.length - 1);\r\n\r\n                if (ch === this._lastChar && this._memcmp(data, pos, this._needle.length - 1)) {\r\n                    if (pos > -this._lookbehind.length) {\r\n                        tokens.push(this._lookbehind.slice(0, this._lookbehind.length + pos));\r\n                    }\r\n\r\n                    tokens.push(MATCH);\r\n\r\n                    this._lookbehind = new Uint8Array();\r\n\r\n                    return [pos + this._needle.length, ...tokens];\r\n                } else {\r\n                    pos += this._occ[ch];\r\n                }\r\n            }\r\n\r\n            // No match.\r\n\r\n            if (pos < 0) {\r\n                // There's too few data for Boyer-Moore-Horspool to run,\r\n                // so let's use a different algorithm to skip as much as\r\n                // we can.\r\n                // Forward pos until\r\n                //   the trailing part of lookbehind + data\r\n                //   looks like the beginning of the needle\r\n                // or until\r\n                //   pos == 0\r\n                while (pos < 0 && !this._memcmp(data, pos, data.length - pos)) {\r\n                    pos++;\r\n                }\r\n            }\r\n\r\n            if (pos >= 0) {\r\n                // Discard lookbehind buffer.\r\n                tokens.push(this._lookbehind);\r\n                this._lookbehind = new Uint8Array();\r\n            } else {\r\n                // Cut off part of the lookbehind buffer that has\r\n                // been processed and append the entire haystack\r\n                // into it.\r\n                const bytesToCutOff = this._lookbehind.length + pos;\r\n\r\n                if (bytesToCutOff > 0) {\r\n                    // The cut off data is guaranteed not to contain the needle.\r\n                    tokens.push(this._lookbehind.slice(0, bytesToCutOff));\r\n                }\r\n\r\n                this._lookbehind = this._lookbehind.slice(bytesToCutOff);\r\n                this._lookbehind = Uint8Array.from(new Array(this._lookbehind.length + data.length), (_, i) => this._charAt(data, i - this._lookbehind.length));\r\n\r\n                return [data.length, ...tokens];\r\n            }\r\n        }\r\n\r\n        if (pos >= 0) {\r\n            pos += buf_pos;\r\n        }\r\n\r\n        // Lookbehind buffer is now empty. Perform Boyer-Moore-Horspool\r\n        // search with optimized character lookup code that only considers\r\n        // the current round's haystack data.\r\n        while (pos <= data.length - this._needle.length) {\r\n            const ch = data[pos + this._needle.length - 1];\r\n\r\n            if (ch === this._lastChar\r\n                && data[pos] === this._needle[0]\r\n                && jsmemcmp(this._needle, 0, data, pos, this._needle.length - 1)) {\r\n                if (pos > 0) {\r\n                    tokens.push(data.slice(buf_pos, pos));\r\n                }\r\n\r\n                tokens.push(MATCH);\r\n\r\n                return [pos + this._needle.length, ...tokens];\r\n            } else {\r\n                pos += this._occ[ch];\r\n            }\r\n        }\r\n\r\n        // There was no match. If there's trailing haystack data that we cannot\r\n        // match yet using the Boyer-Moore-Horspool algorithm (because the trailing\r\n        // data is less than the needle size) then match using a modified\r\n        // algorithm that starts matching from the beginning instead of the end.\r\n        // Whatever trailing data is left after running this algorithm is added to\r\n        // the lookbehind buffer.\r\n        if (pos < data.length) {\r\n            while (pos < data.length && (data[pos] !== this._needle[0]\r\n                || !jsmemcmp(data, pos, this._needle, 0, data.length - pos))) {\r\n                ++pos;\r\n            }\r\n            if (pos < data.length) {\r\n                this._lookbehind = data.slice(pos);\r\n            }\r\n        }\r\n\r\n        // Everything until pos is guaranteed not to contain needle data.\r\n        if (pos > 0) {\r\n            tokens.push(data.slice(buf_pos, pos < data.length ? pos : data.length));\r\n        }\r\n\r\n        return [data.length, ...tokens];\r\n    }\r\n\r\n    private _charAt(data: Uint8Array, pos: number): number {\r\n        if (pos < 0) {\r\n            return this._lookbehind[this._lookbehind.length + pos];\r\n        } else {\r\n            return data[pos];\r\n        }\r\n    };\r\n\r\n    private _memcmp(data: Uint8Array, pos: number, len: number): boolean {\r\n        for (let i = 0; i < len; i++) {\r\n            if (this._charAt(data, pos + i) !== this._needle[i]) {\r\n                return false\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n}\r\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass DuplicateCharacterError extends Error {\n    constructor(index, char) {\n        super(`duplicate character \"${String.fromCharCode(char)}\" found at index ${index}`);\n    }\n}\nexports.DuplicateCharacterError = DuplicateCharacterError;\nclass UnexpectedCharacterError extends Error {\n    constructor(index, char) {\n        super(`unexpected character \"${String.fromCharCode(char)}\" found at index ${index}`);\n    }\n}\nexports.UnexpectedCharacterError = UnexpectedCharacterError;\nfunction strToChars(str) {\n    return str.split('').map((c) => c.charCodeAt(0));\n}\nconst zero = BigInt(0);\nclass Base {\n    constructor(charset) {\n        this._charmap = new Map();\n        this._charset = charset;\n        for (const [index, char] of strToChars(charset).entries()) {\n            if (this._charmap.has(char)) {\n                throw new DuplicateCharacterError(index, char);\n            }\n            this._charmap.set(char, BigInt(index));\n        }\n        this._radix = BigInt(charset.length);\n    }\n    get charset() {\n        return this._charset;\n    }\n    get radix() {\n        return this._charset.length;\n    }\n    parse(number) {\n        let sum = zero;\n        for (const [i, c] of strToChars(number).reverse().entries()) {\n            const value = this._charmap.get(c);\n            if (typeof value === 'undefined') {\n                throw new UnexpectedCharacterError(i, c);\n            }\n            sum += value * (this._radix ** BigInt(i));\n        }\n        return sum;\n    }\n    encode(value) {\n        let numbers = [];\n        while (value > zero) {\n            const rem = value % this._radix;\n            value = (value - rem) / this._radix;\n            numbers.push(this._charset[Number(rem)]);\n        }\n        return numbers.reverse().join('');\n    }\n}\nexports.Base = Base;\n","'use strict';\n\nmodule.exports = HttpHash;\n\nfunction HttpHash() {\n    if (!(this instanceof HttpHash)) {\n        return new HttpHash();\n    }\n\n    this._hash = new RouteNode();\n}\n\nHttpHash.prototype.get = get;\nHttpHash.prototype.set = set;\n\nfunction get(pathname) {\n    var pathSegments = pathname.split('/');\n\n    var hash = this._hash;\n    var splat = null;\n    var params = {};\n    var variablePaths;\n\n    for (var i = 0; i < pathSegments.length; i++) {\n        var segment = pathSegments[i];\n\n        if (!segment && !hash.isSplat) {\n            continue;\n        } else if (\n            segment === '__proto__' &&\n            hash.hasOwnProperty('proto')\n        ) {\n            hash = hash.proto;\n        } else if (hash.staticPaths.hasOwnProperty(segment)) {\n            hash = hash.staticPaths[segment];\n        } else if ((variablePaths = hash.variablePaths)) {\n            if (variablePaths.isSplat) {\n                splat = pathSegments.slice(i).join('/');\n                hash = variablePaths;\n                break;\n            } else {\n                params[variablePaths.segment] = segment;\n                hash = variablePaths;\n            }\n        } else {\n            hash = null;\n            break;\n        }\n    }\n\n    // Match the empty splat\n    if (hash &&\n        hash.handler === null &&\n        hash.variablePaths &&\n        hash.variablePaths.isSplat\n    ) {\n        splat = '';\n        hash = hash.variablePaths;\n    }\n\n    return new RouteResult(hash, params, splat);\n}\n\nfunction set(pathname, handler) {\n    var pathSegments = pathname.split('/');\n    var hash = this._hash;\n    var lastIndex = pathSegments.length - 1;\n    var splatIndex = pathname.indexOf('*');\n    var hasSplat = splatIndex >= 0;\n\n    if (hasSplat && splatIndex !== pathname.length - 1) {\n        throw SplatError(pathname);\n    }\n\n    for (var i = 0; i < pathSegments.length; i++) {\n        var segment = pathSegments[i];\n\n        if (!segment) {\n            continue;\n        }\n\n        if (hasSplat && i === lastIndex) {\n            hash = (\n                hash.variablePaths ||\n                (hash.variablePaths = new RouteNode(hash, segment, true))\n            );\n\n            if (!hash.isSplat) {\n                throw RouteConflictError(pathname, hash);\n            }\n        } else if (segment.indexOf(':') === 0) {\n            segment = segment.slice(1);\n            hash = (\n                hash.variablePaths ||\n                (hash.variablePaths = new RouteNode(hash, segment))\n            );\n\n            if (hash.segment !== segment || hash.isSplat) {\n                throw RouteConflictError(pathname, hash);\n            }\n        } else if (segment === '__proto__') {\n            hash = (\n                (\n                    hash.hasOwnProperty('proto') &&\n                    hash.proto\n                ) ||\n                (hash.proto = new RouteNode(hash, segment))\n            );\n        } else {\n            hash = (\n                (\n                    hash.staticPaths.hasOwnProperty(segment) &&\n                    hash.staticPaths[segment]\n                ) ||\n                (hash.staticPaths[segment] = new RouteNode(hash, segment))\n            );\n        }\n    }\n\n    if (hash.handler === null) {\n        hash.src = pathname;\n        hash.handler = handler;\n    } else {\n        throwRouteConflictError(pathname, hash);\n    }\n}\n\nfunction RouteNode(parent, segment, isSplat) {\n    this.parent = parent || null;\n    this.segment = segment || null;\n    this.handler = null;\n    this.staticPaths = {};\n    this.variablePaths = null;\n    this.isSplat = !!isSplat;\n    this.src = null;\n}\n\nfunction RouteResult(node, params, splat) {\n    this.handler = node && node.handler || null;\n    this.splat = splat;\n    this.params = params;\n    this.src = node && node.src || null;\n}\n\nfunction SplatError(pathname) {\n    var err = new Error('The splat * must be the last segment of the path');\n    err.pathname = pathname;\n    return err;\n}\n\nfunction RouteConflictError(pathname, hash) {\n    var conflictPath = hash.isSplat ? '' : '/';\n\n    while (hash && hash.parent) {\n        var prefix = (\n            !hash.isSplat &&\n            hash === hash.parent.variablePaths\n        ) ? ':' : '';\n\n        conflictPath = '/' + prefix + hash.segment + conflictPath;\n\n        hash = hash.parent;\n    }\n\n    var err = new Error('Route conflict');\n    err.attemptedPath = pathname;\n    err.conflictPath = conflictPath;\n\n    return err;\n}\n\n// Break this out to prevent deoptimization of path.set\nfunction throwRouteConflictError(pathname, hash) {\n    throw RouteConflictError(pathname, hash);\n}\n","import { Summer as SHA1Summer, SumInput, sum as sha1sum } from '../../lib/sha1';\r\n\r\ninterface B2File {\r\n    accountId: string;\r\n    action: 'start' | 'upload' | 'hide' | 'folder';\r\n    bucketId: string;\r\n    contentLength: number;\r\n    contentSha1: string;\r\n    contentType: string;\r\n    fileId: string;\r\n    fileInfo: { [key: string]: string };\r\n    fileName: string;\r\n    uploadTimestamp: number;\r\n}\r\n\r\nexport interface B2Bucket {\r\n    bucketId: string;\r\n    put(file: any, name: string, length: number, options?: { contentType?: string, checksum?: string }): Promise<string>;\r\n    get(fileId: string, options?: { range?: string, contentDisposition?: string }): Promise<File>;\r\n}\r\n\r\ninterface AuthorizedAccount {\r\n    apiUrl: string;\r\n    downloadUrl: string;\r\n    authorizationToken: string;\r\n}\r\n\r\ntype Uploader = (file: SumInput, name: string, length: number, options: { contentType?: string, checksum?: string }) => Promise<B2File>;\r\ntype UploaderFactory = AsyncIterator<Uploader>;\r\n\r\ninterface UploadURL {\r\n    uploadUrl: string;\r\n    authorizationToken: string;\r\n}\r\n\r\ntype AccountFunction = (renew?: boolean) => Promise<AuthorizedAccount>;\r\ntype AccountFactory = AsyncIterator<AuthorizedAccount>;\r\n\r\nexport interface File extends ReadableStream<Uint8Array> {\r\n    get(key: string): string;\r\n}\r\n\r\nconst Expired = Symbol('expired');\r\n\r\nexport class B2APIError extends Error {\r\n    constructor(data: any, ...extra: any[]) {\r\n        super(`B2APIError: ${data.code} - ${data.message} [${extra.join(' ')}]`);\r\n    }\r\n}\r\n\r\nfunction strToBuf(str: string): Uint8Array {\r\n    return new Uint8Array(str.split('').map((c) => c.charCodeAt(0)));\r\n}\r\n\r\nfunction createSummingReadableStream(input: SumInput): ReadableStream<Uint8Array> {\r\n    if (input instanceof ReadableStream) {\r\n        // if (input instanceof ReadableStream) {\r\n        // const summer = new SHA1Summer();\r\n        // const ts = new TransformStream<Uint8Array, Uint8Array>({\r\n        //     transform(chunk: Uint8Array, controller: TransformStreamDefaultController<Uint8Array>): void {\r\n        //         summer.push(chunk);\r\n        //         controller.enqueue(chunk);\r\n        //     },\r\n        //     flush(controller: TransformStreamDefaultController<Uint8Array>): void {\r\n        //         try {\r\n        //             controller.enqueue(strToBuf(summer.digest('hex')));\r\n        //             controller.terminate();\r\n        //         } finally {\r\n        //             summer.close();\r\n        //         }\r\n        //     }\r\n        // });\r\n        // return input.pipeThrough(ts);\r\n\r\n        const ts = new TransformStream();\r\n        (async function() {\r\n            const summer = new SHA1Summer();\r\n\r\n            const w = ts.writable.getWriter();\r\n            const r = input.getReader();\r\n            while (true) {\r\n                const { done, value } = await r.read();\r\n                if (done) {\r\n                    break;\r\n                }\r\n\r\n                summer.push(value);\r\n                await w.write(value);\r\n            }\r\n\r\n            await w.write(strToBuf(summer.digest('hex')));\r\n            await w.close();\r\n        })();\r\n\r\n        return ts.readable;\r\n    }\r\n\r\n    if (!(input instanceof Uint8Array)) {\r\n        if (typeof input === 'string') {\r\n            input = new Uint8Array(input.split('').map((c) => c.charCodeAt(0)));\r\n        } else if (ArrayBuffer.isView(input)) {\r\n            input = new Uint8Array(input.buffer);\r\n        } else if (input instanceof ArrayBuffer) {\r\n            input = new Uint8Array(input);\r\n        } else {\r\n            throw new Error(`unsupported input type: ${input[Symbol.toStringTag]}`);\r\n        }\r\n    }\r\n\r\n    // return new ReadableStream({\r\n    //     async pull(controller: ReadableStreamDefaultController<Uint8Array>): Promise<void> {\r\n    //         controller.enqueue(input as Uint8Array);\r\n    //         controller.enqueue(await sha1sum(input));\r\n    //         controller.close();\r\n    //     },\r\n    // })\r\n\r\n    const ts = new TransformStream<Uint8Array, Uint8Array>({\r\n        async transform(chunk, controller): Promise<void> {\r\n            controller.enqueue(chunk);\r\n            controller.enqueue(strToBuf(await sha1sum(chunk, 'hex')));\r\n            controller.terminate();\r\n        },\r\n    });\r\n\r\n    (async function() {\r\n        const w = ts.writable.getWriter();\r\n        await w.write(input as Uint8Array);\r\n        await w.close();\r\n    })()\r\n\r\n    return ts.readable;\r\n}\r\n\r\nasync function createUploader(account: AccountFunction, bucketId: string): Promise<Uploader> {\r\n    for (let i = 0; i < 2; i++) {\r\n        const { apiUrl, authorizationToken } = await account(!!i);\r\n        const res = await fetch(apiUrl + '/b2api/v2/b2_get_upload_url', {\r\n            method: 'POST',\r\n            headers: { 'Authorization': authorizationToken },\r\n            body: JSON.stringify({ bucketId }),\r\n        });\r\n\r\n        var body = await res.json();\r\n        if (res.status === 200) {\r\n            break;\r\n        }\r\n\r\n        switch (body.code) {\r\n            default:\r\n                throw new B2APIError(body);\r\n            case 'expired_auth_token':\r\n        }\r\n    }\r\n\r\n    const { uploadUrl, authorizationToken } = body as UploadURL;\r\n    return async (file: SumInput, name: string, length: number, options) => {\r\n        options = options || {};\r\n\r\n        let body: BodyInit;\r\n        if (options.checksum) {\r\n            body = file;\r\n        } else {\r\n            body = createSummingReadableStream(file);\r\n        }\r\n        const res = await fetch(uploadUrl, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Authorization': authorizationToken,\r\n                'X-Bz-File-Name': encodeURIComponent(name),\r\n                'Content-Type': options.contentType || 'b2/x-auto',\r\n                'Content-Length': (options.checksum ? length : length + 40).toString(),\r\n                'X-Bz-Content-Sha1': options.checksum || 'hex_digits_at_end',\r\n            },\r\n            body,\r\n        });\r\n\r\n        const data = await res.json();\r\n\r\n        if (res.status === 200) {\r\n            return data;\r\n        }\r\n\r\n        switch (data.code) {\r\n            case 'bad_auth_token':\r\n            case 'expired_auth_token':\r\n            case 'service_unavailable':\r\n                throw Expired;\r\n        }\r\n\r\n        throw new B2APIError(data);\r\n    };\r\n}\r\n\r\nasync function* createUploaderFactory(account: AccountFunction, bucketId: string): UploaderFactory {\r\n    const queue = [];\r\n    while (true) {\r\n        if (queue.length > 0) {\r\n            yield queue.shift();\r\n        } else {\r\n            const uploader = await createUploader(account, bucketId);\r\n            const uploadFn = async function () {\r\n                const result = await uploader.apply(null, arguments);\r\n                // discard this uploader it throws an exception\r\n                queue.push(uploadFn);\r\n                return result;\r\n            } as Uploader;\r\n            yield uploadFn;\r\n        }\r\n    }\r\n}\r\n\r\nfunction createAccountFunc(accountFactory: AccountFactory): AccountFunction {\r\n    let account;\r\n    return async function (renew?: boolean): Promise<AuthorizedAccount> {\r\n        if (!renew && account) {\r\n            return account;\r\n        }\r\n\r\n        return ({ value: account } = await accountFactory.next()) && account;\r\n    };\r\n}\r\n\r\nclass Bucket {\r\n    private _account: AccountFunction;\r\n    private _uploaderPool: UploaderFactory;\r\n\r\n    constructor(accountFactory: AccountFactory, private _bucketId: string) {\r\n        this._account = createAccountFunc(accountFactory);\r\n        this._uploaderPool = createUploaderFactory(this._account, this._bucketId);\r\n    }\r\n\r\n    get bucketId(): string {\r\n        return this._bucketId;\r\n    }\r\n\r\n    async put(file: BodyInit, name: string, length: number, options: { contentType?: string, checksum?: string }): Promise<string>;\r\n    async put(): Promise<string> {\r\n        for (let i = 0; i < 2; i++) {\r\n            const { value } = await this._uploaderPool.next();\r\n            try {\r\n                return (await value.apply(null, arguments)).fileId;\r\n            } catch (err) {\r\n                if (i || err !== Expired) {\r\n                    throw err;\r\n                }\r\n            }\r\n\r\n            // retry with new uploader\r\n        }\r\n    }\r\n\r\n    async get(fileId: string, options?: { range?: string, contentDisposition?: string }): Promise<File> {\r\n        options = options || {};\r\n        const headers = {};\r\n        if (options.range) {\r\n            headers['Range'] = options.range;\r\n        }\r\n\r\n        const body = { fileId };\r\n        if (options.contentDisposition) {\r\n            body['b2ContentDisposition'] = options.contentDisposition;\r\n        }\r\n\r\n        for (let i = 0; i < 2; i++) {\r\n            const { downloadUrl, authorizationToken } = await this._account(!!i);\r\n            const res = await fetch(downloadUrl + '/b2api/v2/b2_download_file_by_id', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': authorizationToken,\r\n                    'Content-Type': 'application/json',\r\n                    ...headers,\r\n                },\r\n                body: JSON.stringify(body),\r\n            });\r\n\r\n            if (res.status === 200) {\r\n                return Object.defineProperty(res.body, 'get', {\r\n                    value: (k: string) => res.headers.get(k),\r\n                });\r\n            }\r\n\r\n            const data = await res.json();\r\n\r\n            switch (data.code) {\r\n                default:\r\n                    throw new B2APIError(data);\r\n                case 'bad_auth_token':\r\n                case 'expired_auth_token':\r\n                    if (!!i) {\r\n                        throw new B2APIError(data);\r\n                    }\r\n            }\r\n\r\n            // retry with a new downloadUrl\r\n        }\r\n    }\r\n}\r\n\r\nasync function* createAccountFactory(token: string): AsyncIterator<AuthorizedAccount> {\r\n    while (true) {\r\n        const res = await fetch('https://api.backblazeb2.com/b2api/v2/b2_authorize_account', {\r\n            headers: {\r\n                'Authorization': `Basic ${token}`,\r\n                'Accept': 'application/json',\r\n            },\r\n        });\r\n\r\n        const body = await res.json();\r\n\r\n        if (res.status === 200) {\r\n            yield body;\r\n        } else {\r\n            throw new B2APIError(body);\r\n        }\r\n    }\r\n}\r\n\r\nexport class B2Client {\r\n    private _accountFactory: AccountFactory;\r\n\r\n    constructor(id: string);\r\n    constructor(id: string, key: string);\r\n    constructor(id_or_token: string, key?: string) {\r\n        let token = id_or_token;\r\n        if (key) {\r\n            token = btoa(id_or_token + ':' + key);\r\n        }\r\n\r\n        this._accountFactory = createAccountFactory(token);\r\n    }\r\n\r\n    bucket(bucketId: string): Bucket {\r\n        return new Bucket(this._accountFactory, bucketId);\r\n    }\r\n}\r\n","import { B2Client, File as B2File } from './b2';\r\nimport { base63, findExt } from './util';\r\n\r\nexport class ExistingUserError extends Error { }\r\n\r\nexport class UnexpectedExtensionError extends Error {\r\n    constructor(public expected: string, public actual: string) {\r\n        super(`unexpected extension: expected \"${expected}\" but got \"${actual}\"`);\r\n    }\r\n}\r\n\r\nexport interface User {\r\n    email: string;\r\n    created: number;\r\n    apiKey: string;\r\n\r\n    tail(): Promise<DeletableObject>;\r\n    objects(limit: number, start?: any): Promise<DeletableObject[]>;\r\n    store(reader: ReadableStream<Uint8Array>, name: string, size: number, type?: string): Promise<DeletableObject>;\r\n    delete(object: Object): Promise<void>;\r\n\r\n    changeEmail(email: string): Promise<void>;\r\n    changePassword(password: string): Promise<void>;\r\n}\r\n\r\nexport interface Object {\r\n    id: string;\r\n    key: string;\r\n    created: number;\r\n    fileId: string;\r\n    name: string;\r\n    size: number;\r\n    next: string;\r\n    numericId(): string;\r\n}\r\n\r\ninterface InternalObject extends Object {\r\n    [NEXT](): Promise<Object>;\r\n    [DOWNLOAD](): Promise<File>;\r\n    [DOWNLOAD_THUMB](): Promise<File>;\r\n}\r\n\r\nexport interface DeletableObject extends Object {\r\n    delete(): Promise<void>;\r\n}\r\n\r\ntype InternalDeletableObject = InternalObject & DeletableObject;\r\n\r\nexport interface File extends ReadableStream<Uint8Array> {\r\n    name: string;\r\n    type: string;\r\n    size: string;\r\n}\r\n\r\nconst bucket = new B2Client('0027de69ac7eeba0000000001', 'K002bTlHhwt5/FI4h15WjGKuUdMPnKA').bucket('f7ed3e56c96a1c476eae0b1a');\r\n\r\nconst numbers = '0123456789';\r\nconst lowerAlpha = 'abcdefghijklmnopqrstuvwxyz';\r\nconst upperAlpha = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\nconst alphanumeric = numbers + lowerAlpha + upperAlpha;\r\nconst uppernumeric = numbers + upperAlpha;\r\n\r\nfunction randomString(charset, length) {\r\n    return Array.from(Array(length), () => charset.charAt(Math.floor(Math.random() * charset.length))).join('');\r\n}\r\n\r\nfunction encodeKey(kind: string, ref: string): string {\r\n    return encodeURIComponent(`${kind}:${ref}`);\r\n}\r\n\r\nconst objectKey: (ref: string) => string = encodeKey.bind(null, 'object');\r\nconst tailKey: (ref: string) => string = encodeKey.bind(null, 'tail');\r\nconst keyKey: (ref: string) => string = encodeKey.bind(null, 'key');\r\nconst userKey: (ref: string) => string = encodeKey.bind(null, 'user');\r\nconst hashKey: (ref: string) => string = encodeKey.bind(null, 'hash');\r\nconst thumbKey: (ref: string) => string = encodeKey.bind(null, 'thumb');\r\nconst prevKey: (ref: string) => string = encodeKey.bind(null, 'prev');\r\n\r\nasync function digest(algo: string, str: string): Promise<string> {\r\n    const digest = new Uint8Array(await crypto.subtle.digest(algo, Uint8Array.from(new Uint8Array(str.length), (_, i) => str.charCodeAt(i))));\r\n    return Array.from(digest.values()).map((x) => ('0' + x.toString(16)).slice(-2)).join('');\r\n}\r\n\r\nconst sha256sum: (str: string) => Promise<string> = digest.bind(null, 'SHA-256');\r\nconst sha512sum: (str: string) => Promise<string> = digest.bind(null, 'SHA-512');\r\n\r\nconst NEXT = Symbol('next');\r\nconst DOWNLOAD = Symbol('download');\r\nconst DOWNLOAD_THUMB = Symbol('download thumb');\r\nconst NO_USER = Symbol('no user');\r\n\r\nasync function deleteObject(this: User, ref: string): Promise<void> {\r\n    throw new Error('not implemented');\r\n}\r\n\r\nfunction makeRef(key: string, id: string): string {\r\n    return `${key}.${id}`;\r\n}\r\n\r\nfunction makeObjectRef(object: Object): string {\r\n    return `${object.key}.${object.id}`;\r\n}\r\n\r\nasync function generateThumbnail(this: Object): Promise<[string, File]> {\r\n    const file = await bucket.get(this.fileId);\r\n    const res = await fetch('https://muki-image-store--thumb-gen.herokuapp.com/', {\r\n        method: 'POST',\r\n        headers: {\r\n            'content-type': file.get('content-type'),\r\n            'content-length': file.get('content-length'),\r\n        },\r\n        body: file,\r\n    });\r\n\r\n    const fileId = await bucket.put(res.clone().body, this.name + '.thumb', +res.headers.get('content-length'), {\r\n        contentType: 'image/png',\r\n    });\r\n\r\n    return [\r\n        fileId,\r\n        Object.defineProperty(res.body, 'get', {\r\n            value: (k: string) => res.headers.get(k),\r\n        }),\r\n    ];\r\n}\r\n\r\nfunction makeFile(file: B2File): File {\r\n    return Object.defineProperties(file, {\r\n        name: { writable: false, value: this.name },\r\n        type: { writable: false, value: file.get('content-type') },\r\n        size: { writable: false, value: file.get('content-length') },\r\n    });\r\n}\r\n\r\nasync function downloadObjectThumbnail(this: Object): Promise<File> {\r\n    const key = thumbKey(makeObjectRef(this));\r\n    const fileId = await StorKV.get(key);\r\n    if (!fileId) {\r\n        const [ fileId, file ] = generateThumbnail.call(this);\r\n        await StorKV.put(key, fileId);\r\n        return makeFile(file);\r\n    }\r\n\r\n    return makeFile(await bucket.get(fileId));\r\n}\r\n\r\nasync function downloadObject(this: Object): Promise<File> {\r\n    const fileId = this.fileId;\r\n    if (!fileId) {\r\n        return;\r\n    }\r\n\r\n    return makeFile(await bucket.get(fileId));\r\n}\r\n\r\nfunction makeDeletableObject(this: User, object: InternalObject): DeletableObject {\r\n    return Object.defineProperties(object, {\r\n        delete: { writable: false, value: deleteObject.bind(this, makeObjectRef(object)) },\r\n    });\r\n}\r\n\r\nfunction makeInternalObject(object: any): InternalObject {\r\n    return Object.defineProperties(object, {\r\n        numericId: { writable: false, value: () => base63.parse(makeObjectRef(object)).toString() },\r\n        [NEXT]: { writable: false, value: getObject.bind(this, object.next) },\r\n        [DOWNLOAD]: { writable: false, value: downloadObject.bind(object) },\r\n        [DOWNLOAD_THUMB]: { writable: false, value: downloadObjectThumbnail.bind(object) },\r\n    });\r\n}\r\n\r\nasync function getObject(this: User, ref: string): Promise<InternalDeletableObject>;\r\nasync function getObject(this: typeof NO_USER, ref: string): Promise<InternalObject>;\r\nasync function getObject(this: typeof NO_USER | User, ref: string): Promise<InternalDeletableObject> {\r\n    if (!ref) {\r\n        return;\r\n    }\r\n\r\n    let object = await StorKV.get(objectKey(ref), 'json');\r\n    if (!object) {\r\n        return;\r\n    }\r\n\r\n    object = makeInternalObject(object);\r\n\r\n    return this === NO_USER ? object : makeDeletableObject.call(this, object);\r\n}\r\n\r\nfunction getTailRef(userHash: string): Promise<string> {\r\n    return StorKV.get(tailKey(userHash));\r\n}\r\n\r\nasync function uploadObject(this: User, userHash: string, input: BodyInit, name: string, size: number, type?: string): Promise<InternalDeletableObject> {\r\n    const created = Date.now();\r\n\r\n    const fileId = await bucket.put(input, await sha256sum(`${created}-${name || randomString(alphanumeric, 8)}`), size, {\r\n        contentType: type,\r\n    });\r\n\r\n    const next = await StorKV.get(tailKey(userHash), 'text');\r\n\r\n    while (true) {\r\n        const str = randomString(alphanumeric, 15);\r\n        var key = str.slice(0, 6);\r\n        var id = str.slice(6);\r\n        var ref = makeRef(key, id);\r\n\r\n        // \"ensure\" no collision\r\n        if (!(await StorKV.get(objectKey(ref)))) {\r\n            break;\r\n        }\r\n    }\r\n\r\n    const object = { id, key, next, created, fileId, name, size };\r\n    await Promise.all([\r\n        StorKV.put(objectKey(ref), JSON.stringify(object)),\r\n        StorKV.put(tailKey(userHash), ref),\r\n        StorKV.put(prevKey(next), ref),\r\n    ]);\r\n\r\n    return makeDeletableObject.call(this, makeInternalObject(object));\r\n}\r\n\r\nasync function listObjects(this: User, userHash: string, limit: number, start?: any): Promise<InternalDeletableObject[]> {\r\n    const firstObject = start && typeof start === 'string' ? await getObject.call(this, start) : await getTailObject.call(this, userHash);\r\n    if (!firstObject) {\r\n        return [];\r\n    }\r\n\r\n    const objects = [firstObject];\r\n    while (objects.length < limit) {\r\n        const object = await objects[objects.length - 1][NEXT]();\r\n        if (!object) {\r\n            break;\r\n        }\r\n\r\n        objects.push(object);\r\n    }\r\n\r\n    return objects;\r\n}\r\n\r\nasync function getTailObject(this: User, userHash: string): Promise<InternalDeletableObject> {\r\n    return getObject.call(this, await getTailRef(userHash));\r\n}\r\n\r\nasync function changeUserEmail(this: User, userHash: string, email: string): Promise<void> {\r\n    const newUserHash = await sha256sum(email);\r\n\r\n    await Promise.all([\r\n        StorKV.put(userKey(newUserHash), JSON.stringify(this)),\r\n        StorKV.put(hashKey(newUserHash), await StorKV.get(hashKey(userHash))),\r\n        StorKV.delete(userKey(userHash)),\r\n        StorKV.delete(hashKey(userHash)),\r\n    ]);\r\n}\r\n\r\nasync function changeUserPassword(this: User, userHash: string, password: string): Promise<void> {\r\n    return StorKV.put(hashKey(userHash), await sha256sum(password));\r\n}\r\n\r\nasync function getUser(userHash: string): Promise<User> {\r\n    const user = await StorKV.get(userKey(userHash), 'json');\r\n    if (!user) {\r\n        return;\r\n    }\r\n\r\n    return Object.defineProperties(user, {\r\n        tail: { writable: false, value: getTailObject.bind(user, userHash) },\r\n        objects: { writable: false, value: listObjects.bind(user, userHash) },\r\n        store: { writable: false, value: uploadObject.bind(user, userHash) },\r\n        delete: { writable: false, value: (object: Object) => deleteObject.call(user, makeObjectRef(object)) },\r\n        changeEmail: { writable: false, value: changeUserEmail.bind(user, userHash) },\r\n        changePassword: { writable: false, value: changeUserPassword.bind(user, userHash) },\r\n    });\r\n}\r\n\r\nfunction parseNumericId(numericId: string): string {\r\n    return base63.encode(BigInt(numericId));\r\n}\r\n\r\nexport default {\r\n    async createUser(email: string, password: string): Promise<string> {\r\n        const userHash = await sha256sum(email);\r\n        if (await StorKV.get(userKey(userHash))) {\r\n            throw new ExistingUserError();\r\n        }\r\n\r\n        const created = Date.now();\r\n\r\n        const secretp = sha256sum(password);\r\n\r\n        let apiKey;\r\n        while (await StorKV.get(keyKey(apiKey = randomString(uppernumeric, 32)))) { }\r\n\r\n        const object = { email, created, apiKey };\r\n\r\n        await Promise.all([\r\n            StorKV.put(userKey(userHash), JSON.stringify(object)),\r\n            StorKV.put(hashKey(userHash), await secretp),\r\n            StorKV.put(keyKey(apiKey), userHash),\r\n        ]);\r\n\r\n        return apiKey;\r\n    },\r\n    async getUserByCredentials(email: string, password: string): Promise<User> {\r\n        const userHash = await sha256sum(email);\r\n\r\n        if (await StorKV.get(hashKey(userHash)) !== await sha256sum(password)) {\r\n            return;\r\n        }\r\n\r\n        return getUser(userHash);\r\n    },\r\n    async getUserByApiKey(apiKey: any): Promise<User> {\r\n        if (!apiKey || typeof apiKey !== 'string') {\r\n            return;\r\n        }\r\n\r\n        const userHash: string = await StorKV.get(keyKey(apiKey));\r\n        if (!userHash) {\r\n            return;\r\n        }\r\n\r\n        return getUser(userHash);\r\n    },\r\n    getObject(key: string, id: string): Promise<Object> {\r\n        return getObject.call(NO_USER, makeRef(key, id));\r\n    },\r\n    getObjectByNumericId(numericId: string): Promise<Object> {\r\n        return getObject.call(NO_USER, parseNumericId(numericId));\r\n    },\r\n    async getFile(key: string, id: string, ext: string): Promise<File> {\r\n        const object: InternalObject = await getObject.call(NO_USER, makeRef(key, id));\r\n        if (!object) {\r\n            return;\r\n        }\r\n\r\n        const expectedExt = findExt(object.name);\r\n        if (ext !== expectedExt) {\r\n            throw new UnexpectedExtensionError(expectedExt, ext);\r\n        }\r\n\r\n        return object[DOWNLOAD]();\r\n    },\r\n    async getThumbnail(key: string, id: string, ext: string): Promise<File> {\r\n        const object: InternalObject = await getObject.call(NO_USER, makeRef(key, id));\r\n        if (!object) {\r\n            return;\r\n        }\r\n\r\n        if (ext !== '.png') {\r\n            throw new UnexpectedExtensionError('.png', ext);\r\n        }\r\n\r\n        return object[DOWNLOAD_THUMB]();\r\n    },\r\n}","declare namespace WebAssembly {\r\n    class Module {}\r\n    class Table {\r\n        constructor(options: any);\r\n    }\r\n    class Memory {\r\n        buffer: ArrayBuffer;\r\n        constructor(options: any);\r\n        grow(pages: number): void;\r\n    }\r\n    class Instance {\r\n        exports: any;\r\n        constructor(module: Module, options: any);\r\n    }\r\n}\r\n\r\ndeclare const Sha1Wasm: WebAssembly.Module;\r\n\r\nconst SIZE_OF_CONTEXT = 128;\r\nconst SIZE_OF_DIGEST = 20;\r\n\r\n\r\nconst memory = new WebAssembly.Memory({ initial: 2 });\r\nconst allocs: [number, number][] = [];\r\n\r\nlet view = new Uint8Array(memory.buffer);\r\n\r\nconst instance = new WebAssembly.Instance(Sha1Wasm, {\r\n    module: {},\r\n    env: {\r\n        memory: memory,\r\n        table: new WebAssembly.Table({ initial: 0, element: 'anyfunc' }),\r\n    },\r\n});\r\n\r\nexport type SumInput = string | ArrayBufferLike | ArrayBufferView | ReadableStream<Uint8Array>;\r\n\r\nexport async function sum(input: SumInput): Promise<Uint8Array>;\r\nexport async function sum(input: SumInput, encoding: 'hex'): Promise<string>;\r\nexport async function sum(input: SumInput, encoding?: 'hex'): Promise<any> {\r\n    if (!(input instanceof Uint8Array) && !(input instanceof ReadableStream)) {\r\n        if (typeof input === 'string') {\r\n            input = new Uint8Array(input.split('').map((c) => c.charCodeAt(0)));\r\n        } else if (ArrayBuffer.isView(input)) {\r\n            input = new Uint8Array(input.buffer);\r\n        } else if (input instanceof ArrayBuffer) {\r\n            input = new Uint8Array(input);\r\n        } else {\r\n            throw new Error(`unsupported input type: ${input[Symbol.toStringTag]}`);\r\n        }\r\n    }\r\n\r\n    const ctx = new_context();\r\n    try {\r\n        if (input instanceof ReadableStream) {\r\n            const reader = input.getReader();\r\n            while (true) {\r\n                const { done, value } = await reader.read();\r\n                if (done) {\r\n                    break;\r\n                }\r\n\r\n                if (!value.length) {\r\n                    continue;\r\n                }\r\n\r\n                feed(ctx, value);\r\n            }\r\n        } else {\r\n            feed(ctx, input as Uint8Array);\r\n        }\r\n\r\n        return encoded_result(ctx, encoding);\r\n    } finally {\r\n        free(ctx);\r\n    }\r\n}\r\n\r\nexport class Summer {\r\n    private _context: number;\r\n    private _freed: boolean;\r\n\r\n    constructor() {\r\n        this._context = new_context();\r\n    }\r\n\r\n    push(data: Uint8Array): void {\r\n        this._assert();\r\n        feed(this._context, data);\r\n    }\r\n\r\n    digest(): Uint8Array;\r\n    digest(encoding: 'hex'): string;\r\n    digest(encoding?: 'hex'): any {\r\n        this._assert();\r\n        return encoded_result(this._context, encoding);\r\n    }\r\n\r\n    close(): void {\r\n        this._assert();\r\n        this._freed = true;\r\n        free(this._context);\r\n    }\r\n\r\n    private _assert(): void {\r\n        if (this._freed) {\r\n            throw new Error('Summer may not be used after it has been closed');\r\n        }\r\n    }\r\n}\r\n\r\nfunction new_context(): number {\r\n    const ptr = malloc(SIZE_OF_CONTEXT);\r\n    instance.exports.SHA1Reset(ptr);\r\n    return ptr;\r\n}\r\n\r\nfunction encoded_result(ctx: number): Uint8Array;\r\nfunction encoded_result(ctx: number, encoding: 'hex'): string;\r\nfunction encoded_result(ctx: number, encoding?: string): any {\r\n    const digest = result(ctx);\r\n    if (encoding === 'hex') {\r\n        return Array.from(digest).map((b) => ('0' + b.toString(16)).slice(-2)).join('');\r\n    }\r\n\r\n    return digest;\r\n}\r\n\r\nfunction result(context_ptr: number): Uint8Array {\r\n    const ptr = malloc(SIZE_OF_DIGEST);\r\n    try {\r\n        handle_error(instance.exports.SHA1Result(context_ptr, ptr));\r\n        return view.slice(ptr, ptr + SIZE_OF_DIGEST);\r\n    } finally {\r\n        free(ptr);\r\n    }\r\n}\r\n\r\nfunction feed(context_ptr: number, buffer: Uint8Array): void {\r\n    const ptr = malloc(buffer.length);\r\n    try {\r\n        view.set(buffer, ptr);\r\n        handle_error(instance.exports.SHA1Input(context_ptr, ptr, buffer.length));\r\n    } finally {\r\n        free(ptr);\r\n    }\r\n}\r\n\r\nfunction handle_error(code: number): void {\r\n    if (code === 1) {\r\n        throw new Error('input too long');\r\n    } else if (code === 2) {\r\n        throw new Error('state error');\r\n    } else if (code !== 0) {\r\n        throw new Error(`unexpected error code: ${code}`);\r\n    }\r\n}\r\n\r\n// function _malloc(length: number): number {\r\n//     const ptr = _mallocx(length);\r\n//     console.log('malloc', ptr, length);\r\n//     return ptr;\r\n// }\r\n\r\nfunction malloc(length: number): number {\r\n    if (!allocs.length) {\r\n        allocs.push([0, length]);\r\n        return 0;\r\n    }\r\n\r\n    // look for space in between allocations\r\n\r\n    const last_alloc = allocs[allocs.length - 1];\r\n    if (allocs.length > 1) {\r\n        if (last_alloc[0] + last_alloc[1] + length > view.length) {\r\n            // not enough memory to allocate\r\n            memory.grow(1);\r\n            view = new Uint8Array(memory.buffer);\r\n            return malloc(length);\r\n        }\r\n\r\n        for (let i = 0; i < allocs.length - 1; i++) {\r\n            const a = allocs[i][0] + allocs[i][1];\r\n            const b = allocs[i + 1][0];\r\n            if (b - a >= length) {\r\n                allocs.splice(i + 1, 0, [a, length]);\r\n                return a;\r\n            }\r\n        }\r\n    }\r\n\r\n    // allocate at the end\r\n\r\n    const ptr = last_alloc[0] + last_alloc[1];\r\n    allocs.push([ptr, length]);\r\n    return ptr;\r\n}\r\n\r\n// function _free(ptr: number): void {\r\n//     console.log('free', ptr);\r\n//     _freex(ptr);\r\n// }\r\n\r\nfunction free(ptr: number): void {\r\n    for (const [i, alloc] of allocs.entries()) {\r\n        if (alloc[0] === ptr) {\r\n            allocs.splice(i, 1);\r\n            return;\r\n        }\r\n    }\r\n\r\n    throw new Error('attempted to free invalid pointer');\r\n}","import { Base } from 'baseconv';\r\n\r\nexport function findExt(name: string): string {\r\n    const dot = name.lastIndexOf('.');\r\n    return dot === -1 ? '' : name.slice(dot);\r\n}\r\n\r\nexport function baseUrl(url: URL, request: Request): string {\r\n    const forwardedProto = request.headers.get('x-muki-forwarded-proto');\r\n    const forwardedHost = request.headers.get('x-muki-forwarded-host');\r\n    return `${forwardedProto || url.protocol}//${forwardedHost || url.host}`;\r\n}\r\n\r\nexport const base63 = new Base('0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.');\r\n","import HttpHash = require('http-hash');\r\n\r\nimport routers from './routers/index';\r\n\r\nasync function routeRequest(this: HttpHash, url: URL, request: Request, waitUntil: WaitUntil): Promise<Response> {\r\n    const route = this.get(url.pathname);\r\n    return route && route.handler.call(route, url, request, waitUntil);\r\n}\r\n\r\nasync function handleRequest(request: Request, waitUntil: WaitUntil): Promise<Response> {\r\n    try {\r\n        const url = new URL(request.url);\r\n        const router = routers[url.hostname];\r\n        if (router) {\r\n            var response = await routeRequest.call(router, url, request, waitUntil);\r\n        }\r\n\r\n        return response || new Response('404 not found', { status: 404 });\r\n    } catch (err) {\r\n        return new Response(err.stack, { status: 500 });\r\n    }\r\n}\r\n\r\naddEventListener('fetch', (event: FetchEvent) => event.respondWith(handleRequest(event.request, event.waitUntil)));\r\n","import parseFormData from 'fd';\r\n\r\nimport imgstor from '../../../lib/imgstor';\r\n\r\nexport = async function(url: URL, request: Request): Promise<Response> {\r\n    if (request.method !== 'POST') return new Response(null, { status: 405 });\r\n\r\n    try {\r\n        var fd = await parseFormData(request);\r\n    } catch (err) {\r\n        return new Response(null, { status: 400 });\r\n    }\r\n\r\n    const email = fd.get('e');\r\n    const password = fd.get('p');\r\n\r\n    if (!email || !password || typeof email !== 'string' || typeof password !== 'string') {\r\n        return new Response(null, { status: 400 });\r\n    }\r\n\r\n    const user = await imgstor.getUserByCredentials(email, password);\r\n    if (!user) {\r\n        return new Response(null, { status: 401 });\r\n    }\r\n\r\n    return new Response(`1,${user.apiKey},Never!,0`);\r\n}","import parseFormData from 'fd';\r\n\r\nimport imgstor, { Object } from '../../../lib/imgstor';\r\nimport { findExt, baseUrl } from '../../../lib/util';\r\n\r\nfunction objectLine(url: URL, request: Request, object: Object): string {\r\n    return `${object.numericId()},${object.created},${baseUrl(url, request)}/${object.key}/${object.id}${findExt(object.name)},${object.name},0,0`\r\n}\r\n\r\nexport = async function (url: URL, request: Request): Promise<Response> {\r\n    if (request.method !== 'POST') return new Response(null, { status: 405 });\r\n\r\n    try {\r\n        var fd = await parseFormData(request);\r\n    } catch (err) {\r\n        return new Response(null, { status: 400 });\r\n    }\r\n\r\n    const user = await imgstor.getUserByApiKey(fd.get('k'));\r\n    if (!user) {\r\n        return new Response(null, { status: 403 });\r\n    }\r\n\r\n    const list = await user.objects(+fd.get('limit') || 50, fd.get('start'));\r\n    if (!list.length) {\r\n        return new Response();\r\n    }\r\n\r\n    return new Response(list.map(objectLine.bind(null, url, request)).join('\\n') + '\\n', {\r\n        headers: {\r\n            'Next-Cursor': list[list.length - 1].next,\r\n        },\r\n    });\r\n}\r\n","import parseFormData from 'fd';\r\n\r\nimport imgstor, { ExistingUserError } from '../../../lib/imgstor';\r\n\r\nexport = async function(url: URL, request: Request): Promise<Response> {\r\n    if (request.method !== 'POST') return new Response(null, { status: 405 });\r\n\r\n    try {\r\n        var fd = await parseFormData(request);\r\n    } catch (err) {\r\n        return new Response(null, { status: 400 });\r\n    }\r\n\r\n    const email = fd.get('e');\r\n    const password = fd.get('p');\r\n\r\n    if (!email || !password || typeof email !== 'string' || typeof password !== 'string') {\r\n        return new Response(null, { status: 400 });\r\n    }\r\n\r\n    try {\r\n        await imgstor.createUser(email, password);\r\n    } catch (err) {\r\n        if (err instanceof ExistingUserError) {\r\n            return new Response(null, { status: 409 });\r\n        }\r\n\r\n        throw err;\r\n    }\r\n\r\n    return new Response();\r\n}\r\n","import parseFormData from 'fd';\r\n\r\nimport imgstor from '../../../lib/imgstor';\r\nimport { findExt, baseUrl } from '../../../lib/util';\r\n\r\nexport = async function (url: URL, request: Request): Promise<Response> {\r\n    if (request.method !== 'POST') return new Response(null, { status: 405 });\r\n\r\n    try {\r\n        var fd = await parseFormData(request);\r\n    } catch (err) {\r\n        return new Response(err.stack, { status: 400 });\r\n    }\r\n\r\n    const user = await imgstor.getUserByApiKey(fd.get('k'));\r\n    if (!user) {\r\n        return new Response(null, { status: 403 });\r\n    }\r\n\r\n    const file = fd.get('f');\r\n    if (!file || typeof file === 'string') {\r\n        return new Response(null, { status: 400 });\r\n    }\r\n\r\n    const object = await user.store(file, file.name, file.size, file.type);\r\n\r\n    return new Response(`0,${baseUrl(url, request)}/${object.key}/${object.id}${findExt(object.name)},${object.numericId()},0`);\r\n}","import HttpHash, { RouteResult } from 'http-hash';\r\n\r\nimport imgstor, { File, UnexpectedExtensionError } from '../../lib/imgstor';\r\nimport { findExt } from '../../lib/util';\r\n\r\nfunction imageHandler(thumbnail?: boolean): Handler {\r\n    const getFile = thumbnail ? imgstor.getThumbnail : imgstor.getFile;\r\n    return async function image(this: RouteResult, url: URL): Promise<Response> {\r\n        const id = this.params['id'];\r\n        const ext = findExt(id);\r\n\r\n        try {\r\n            var file: File = await getFile.call(null, this.params['key'], id.slice(0, id.length - ext.length), ext);\r\n            if (!file) {\r\n                return;\r\n            }\r\n        } catch (err) {\r\n            if (err instanceof UnexpectedExtensionError) {\r\n                return new Response(null, {\r\n                    status: 301,\r\n                    headers: {\r\n                        'Location': url.pathname.slice(0, url.pathname.length - ext.length) + err.expected,\r\n                    }\r\n                });\r\n            }\r\n\r\n            throw err;\r\n        }\r\n\r\n        return new Response(file, {\r\n            headers: {\r\n                'Content-Length': file.size,\r\n                'Content-Type': file.type,\r\n                'Content-Disposition': `filename=\"${encodeURIComponent(file.name)}\"`,\r\n            },\r\n        });\r\n    }\r\n}\r\n\r\ndeclare type Handler = (this: RouteResult, url: URL, request: Request, waitUntil: WaitUntil) => Response | Promise<Response>;\r\n\r\ndeclare const require: Function;\r\n\r\nexport default (function (): HttpHash<Handler> {\r\n    const router = new HttpHash<Handler>();\r\n\r\n    router.set('/api/auth', (require('./api/auth')));\r\n    router.set('/api/hist', (require('./api/hist')));\r\n    router.set('/api/new', (require('./api/new')));\r\n    router.set('/api/up', (require('./api/up')));\r\n    router.set('/thumb/:key/:id', imageHandler(true));\r\n    router.set('/:key/:id', imageHandler());\r\n    router.set('/test', (require('./test')));\r\n    router.set('/home', () => fetch('https://puushes.storage.googleapis.com/public/index.html'));\r\n\r\n    return router;\r\n})();\r\n","export = async function (url: URL, request: Request): Promise<Response> {\r\n    let n = 1;\r\n    const ts = new TransformStream<Uint8Array, Uint8Array>({\r\n        start: () => { },\r\n        transform(_: Uint8Array, controller: TransformStreamDefaultController<Uint8Array>): void {\r\n            controller.enqueue(new Uint8Array(`received chunk ${n}\\n`.split('').map((c) => c.charCodeAt(0))));\r\n        },\r\n        flush(controller: TransformStreamDefaultController<Uint8Array>): void {\r\n            controller.enqueue(new Uint8Array(`all chunks received\\n`.split('').map((c) => c.charCodeAt(0))));\r\n        }\r\n    });\r\n\r\n    return new Response(request.body.pipeThrough(ts), {\r\n        headers: {\r\n            'content-type': 'text/plain',\r\n        }\r\n    });\r\n}\r\n","import i_muki_pw from './i.muki.pw/index';\r\n// import mv_ssttevee_com from './mv.ssttevee.com/index';\r\n\r\nexport default {\r\n    'i.muki.pw': i_muki_pw,\r\n    // 'mv.ssttevee.com': mv_ssttevee_com,\r\n}\r\n"],"sourceRoot":""}